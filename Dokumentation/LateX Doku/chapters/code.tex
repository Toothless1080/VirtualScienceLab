% !TeX root = ../pythonTutorial.tex
\chapter{Code}
\section{Allgemeine Scripte}

Viele Funktionen sind in Unity standardmäßig implementiert. So zum Beispiel die Möglichkeit physikalische Eigentschaften auf ein Objekt zu definieren. Dies macht es anfassbar und ermöglicht die Interaktion mit dem Objekt. \newline

Eigene bzw. weitere und schwierigere Funktionen müssen hingegen selbst implementiert werden. Alle von uns implementierten Funktionen und Methoden befinden sich im Projekt unter Assets -> Scripts. Alle Scripte wurden in C\# programmiert. \newline

Es gibt Scripte, die sich durchs ganze Projekt ziehen und andere, die sich auf bestimmte Szenen beziehen. Allgemein können jedoch alle Scripte überall verwendet werden.

\clearpage
\subsection{Scene\_Management.cs}

Das Scene Management Script dient zur richtigen Positionierung des Spielers, wenn er den Flur betritt. Je nachdem aus welchem Raum er kommt ändert sich die Startposition. Das Script muss in jeder Szene eingebaut sein, da nur so die zuletzt verwendete Szene ausgelesen werden kann. 

\lstinputlisting{../../VirtualScienceLabProject/Assets/Scripts/Scene_Management.cs}

Das Script wird in der \textit{start()} Methode ausgeführt - also beim Laden der Szene. Am Anfang wird der Szenenname rausgefunden und in einer Variable gespeichert. Anschließend erfolgt eine Abfrage, ob die aktuelle Szene der "Flur" ist oder nicht. Falls nicht, wird der aktuelle Scenenname als \textit{last\_scene} in einer Globalen Variable gespeichert. Wenn es sich um den Flur handelt wird die Position des Players entsprechend der letzten Szene im Flur geändert.

\clearpage
\subsection{Globals.cs}

In der Globals.cs werden globale Variablen gespeichert, die Szenenübergreifend benötigt werden. Aktuell ist dies nur der letzte Szenenname.

\lstinputlisting{../../VirtualScienceLabProject/Assets/Scripts/Globals.cs}

\clearpage
\subsection{Load\_Publics.cs}

In diesem Script werden alle Variablen gespeichert, die über ein Script hinaus aber nur innerhalb einer Szene benötigt werden. Das Script wird in jeder Szene eingebunden. Das Objekt auf dem es positioniert ist, spielt dabei keine Rolle. \newline

\lstinputlisting{../../VirtualScienceLabProject/Assets/Scripts/Load_Publics.cs}

Wichtig ist, dass in dem Script eine Klasse definiert ist, die die Variablen und für die Variablen wichtige Funktionen z. B. zum Mapping von manchen Variablen enthält.

\clearpage
\subsection{Sev\_Seg\_Counter.cs}

Die 7-Segment-Anzeige wird in verschiedenen Szenen benutzt. Dieses Script dient dazu eine eingegebenen Zahl auf das 3-Ziffern-Display zu übertragen. \newline
Der Funktion \textit{setSevSegCount()} wird eine Zahl als int und der Name des zugehörigen Parent-Objekts übergeben. Die Zahl wird als String formatiert, sodass sie besser in 3 Teile geteilt werden kann. Das Parent-Objekt wird per \textit{Find} Befehl gesucht und in einer Variable gespeichert. Anschließend wird für jede der 3 Zeichen des Zahl-Strings die Funktion \textit{set\_n()} aufgerufen, welche die entsprechende Position in der 7-Segment-Anzeige in die Zahl umwandelt. \newline

Innerhalb der \textit{set\_n()} Methode werden die Segment-Objekte innerhalb des Parent-Objekts gesucht. Da die Benennung immer gleich ist, kann dies programmatisch anhand eines zusammengesetzten Strings geschehen. Anschließend wird für jedes Segment der Anzeige die Farbe entsprechend einer Vorgabe, die per If-Abfrage anhand der eingegebenen Zahl festgestellt wird, entweder Schwarz oder Rot bzw. Grün gesetzt. Dadurch entsteht die Zahl auf der Anzeige.

\lstinputlisting{../../VirtualScienceLabProject/Assets/Scripts/Sev_Seg_Counter.cs}

\clearpage
\subsection{Display\_Meter\_5\_D.cs}

Ähnlich des Scripts \textit{Sev\_Seg\_counter.cs} ist auch dieses Script zum Anzeigen von Zahlen auf einer 7-Segment-Anzeige gedacht. Die Besonderheit hier ist, dass 5 Ziffern dargestellt werden und die letzten beiden Ziffern nach einem Komma stehen. Also eine Kommazahl. \newline

Der Unterscheid der beiden Scripte besteht rein in der Formatierung der Zahl und der Eingabe einer Double-Variable, anstatt einer Integer-Variable. Der Rest ist identisch. Einzig die \textit{set\_n()}-Methode wird fünf mal anstatt nur drei mal aufgerufen.

\lstinputlisting{../../VirtualScienceLabProject/Assets/Scripts/Display_Meter_5_D.cs}

\clearpage
\section{Szenenspezifische Scripte}
\subsection{Beschleunigung.cs}

Dieses Script ist für die Steuerung der Geschwindigkeit der Teilchen im Teilchenlabor zuständig.

\lstinputlisting{../../VirtualScienceLabProject/Assets/Scripts/Beschleunigung.cs}

Das Script wurde auf die beiden Buttons in der Szene zum Beschleunigen und Abbremsen der Teilchen gelegt. Bei Aufruf der Szene wird zuerst in der \textit{start()} die 7-Segment-Anzeige auf 0 gesetzt. Das ist der Temperatur Startwert. Anschließend wird die Anzeige in der \textit{Update()} jeweils auf den Wert der Temperatur-Variable in der \textit{Load\_Publics.cs} gesetzt. Standardmäßig ist dies 25. \newline

Das Script enthält außerdem Listener, die ausgelöst werden, sobald der Spieler einen der Buttons berührt. Diese Listener unterscheiden dann welcher Button gedrückt wurde und ändern entsprechend die Temperatur-Variable. Nachdem ein Button gedrückt wurde wird es für eine Sekunde unmöglich diesen nochmals zu drücken. Dies wird auch durch eine Farbänderung dargestellt.

\clearpage